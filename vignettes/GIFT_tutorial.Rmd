---
title: "GIFT tutorial"
author: "Pierre Denelle & Patrick Weigelt"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
 %\VignetteIndexEntry{GIFT tutorial}
 %\VignetteEncoding{UTF-8} 
 %\VignetteEngine{knitr::rmarkdown}
editor_options: 
 chunk_output_type: console
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
                      fig.width = 4, fig.height = 4, fig.align = "center")
# Packages --------------------------------------------------------------------
suppressPackageStartupMessages({
  suppressWarnings({
    library("GIFT")
  })
})

options(tinytex.verbose = TRUE)
```

# 1. Overview

The GIFT R package grants an access to the Global Inventory of Floras and
Traits (GIFT) database. This vignette illustrates the most common usages of
the package through three detailed examples:

- 1. Retrieving plant checklists within a given area (example: Mediterranean)
- 2. Getting the distribution of a plant species
- 3. Retrieving trait information for a subset of plant species

\newpage

# 2. Checklists for a region

Let's assume we are interested in having a floristic knowledge of the
Mediterranean basin. For this purpose, we can simply use a shapefile of the
region of interest and feed it to the `GIFT_checklist()` function.  

We do provide a shapefile of this region in the `GIFT` R package, which you
can assess using the `data()` function.

```{r, fig.width = 3, fig.height = 3}
data("med")
plot(med, main = "Shape of Mediterranean\nregion")
```

Please note that the projection used in GIFT is the WGS84, and that all
shapefiles provided should be in this CRS. You can check this using
`sf::st_crs().`

```{r, eval = FALSE}
sf::st_crs(med)
```

Now that we have a shape for the region of interest, let's call
`GIFT_checklist()`. This wrapper function has many arguments which we detail
here.
<br>
First, the taxonomic group of interest. We can be interested in a particular
group of plants, for example only Angiosperms. In that case, we would set the
`taxon_name` argument like this `taxon_name = "Angiospermae"`. If we are
interested in a particular plant family, let's say orchids, then 
`taxon_name = "Orchidaceae"`.
<br>
To see all options for the `taxon_name` argument, you can run the
`GIFT_taxonomy()` function and look at the `taxon_name` column of its output.
<br>
Together with this first argument comes `complete_taxon`. This argument, set by
default to `TRUE` defines whether incomplete checklists **regarding the**
**taxon of interest** should be retrieved. Figure 1 is explaining the
principle.
<br><br>
  
```{r, fig.cap = "Figure 1. Complete taxon", out.width = "50%",echo = FALSE}
knitr::include_graphics("../man/figures/GIFT_complete_taxon.png")
```
<br>
In Figure 1, we want to retrieve checklists of Angiosperms. In the first region
available, region A only one checklist is of interest. This checklist is then
always retrieved. In region B, there is only a checklist of orchids, which is
a subset only of Angiosperms. If `complete_taxon` is set to `FALSE`, then this
checklist won't be retrieved, otherwise yes. Finally, in region C, there is a
checklist of vascular plants and one for orchids. In both cases, the checklist
of vascular plants will be retrieved after filtering out the non-angiosperm
species. The species of Orchids is also retrieved in both cases as it is not
the only one available and as it can complete the floristic knowledge for
Angiosperms in this region.
<br>
<br>
Following arguments of `GIFT_checklist()` relate to the floristic statuses of
plant species. We can for example only be interested in endemic species, or
naturalized species. Default value is retrieving all native species.
<br>
Similarly, two arguments are needed in the function. First, `floristic_group`
defines the group of interest. Second, `complete_floristic` states whether
incomplete regions regarding the floristic group chosen should be retrieved or
not. The logic is detailed in Figure 2 and is similar to the `complete_taxon`
argument shown before.  

<br>
```{r, fig.cap = "Figure 2. Complete floristic", out.width = "50%", echo = FALSE}
knitr::include_graphics("../man/figures/GIFT_complete_floristic.png")
```
<br>

Function returns a list of two tables: metadata and actual checklists.
To get only the metadata, set the argument `list_set_only` to `TRUE`.

```{r, eval=FALSE}
ex <- GIFT_checklist(taxon_name = "Angiospermae",
                     shp = med, overlap = "centroid_inside")

ex_meta <- GIFT_checklist(taxon_name = "Angiospermae",
                          shp = med, overlap = "centroid_inside",
                          list_set_only = TRUE)
```

<br>

```{r, eval=FALSE}
ex <- GIFT_checklist(shp = med, overlap = "centroid_inside",
                     taxon_name = "Angiospermae",
                     complete_taxon = TRUE)
```

<br>

```{r, eval=FALSE}
ex <- GIFT_checklist(shp = med, overlap = "centroid_inside",
                     taxon_name = "Angiospermae",
                     floristic_group = "native",
                     complete_floristic = TRUE)
```

How remove_overlap works.
<br>
```{r, fig.cap = "Figure 3. No overlap", out.width = "50%", echo = FALSE}
knitr::include_graphics("../man/figures/GIFT_no_overlap.png")
```
<br>

```{r, fig.cap = "Figure 4. Overlap threshold", out.width = "50%", echo = FALSE}
knitr::include_graphics("../man/figures/GIFT_overlap_th.png")
```
<br>

```{r, fig.cap = "Figure 5. GIFT spatial", out.width = "50%", echo = FALSE}
knitr::include_graphics("../man/figures/GIFT_spatial.png")
```
<br>

```{r, eval=FALSE}
ex <- GIFT_checklist(shp = med, overlap = "centroid_inside",
                     taxon_name = "Angiospermae",
                     remove_overlap = TRUE)
```

Function also works with own coordinates, point.

```{r, eval=FALSE}
custom_point <- cbind(9.9, 51)

ex <- GIFT_checklist(coordinates = custom_point, overlap = "extent_intersect",
                     taxon_name = "Angiospermae",
                     remove_overlap = TRUE)
```

# 3. Distribution of species

```{r, eval=FALSE}

```


# 4. Trait data

Raw traits, and traits after taxonomic harmonization.

```{r, eval=FALSE}

```

```{r, eval=FALSE}

```

# 5. References

When using the GIFT database and the GIFT R package, here are the two
resources to cite:

[Weigelt, P., König, C., & Kreft, H. (2020). GIFT – A Global Inventory of Floras and Traits for macroecology and biogeography. Journal of Biogeography, 47(1), 16–43.](https://doi.org/10.1111/jbi.13623)

[GIFT R package](https://github.com/BioGeoMacro/GIFT)
